<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rob Loftus">
<meta name="dcterms.date" content="2025-05-07">

<title>A Replication of Karlan and List (2007) – Rob’s Website</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Rob’s Website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.qmd"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html"> 
<span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#description" id="toc-description" class="nav-link" data-scroll-target="#description">Description</a></li>
  <li><a href="#balance-test" id="toc-balance-test" class="nav-link" data-scroll-target="#balance-test">Balance Test</a></li>
  </ul></li>
  <li><a href="#experimental-results" id="toc-experimental-results" class="nav-link" data-scroll-target="#experimental-results">Experimental Results</a>
  <ul class="collapse">
  <li><a href="#charitable-contribution-made" id="toc-charitable-contribution-made" class="nav-link" data-scroll-target="#charitable-contribution-made">Charitable Contribution Made</a></li>
  <li><a href="#differences-between-match-rates" id="toc-differences-between-match-rates" class="nav-link" data-scroll-target="#differences-between-match-rates">Differences between Match Rates</a></li>
  <li><a href="#size-of-charitable-contribution" id="toc-size-of-charitable-contribution" class="nav-link" data-scroll-target="#size-of-charitable-contribution">Size of Charitable Contribution</a></li>
  </ul></li>
  <li><a href="#simulation-experiment" id="toc-simulation-experiment" class="nav-link" data-scroll-target="#simulation-experiment">Simulation Experiment</a>
  <ul class="collapse">
  <li><a href="#law-of-large-numbers" id="toc-law-of-large-numbers" class="nav-link" data-scroll-target="#law-of-large-numbers">Law of Large Numbers</a></li>
  <li><a href="#central-limit-theorem" id="toc-central-limit-theorem" class="nav-link" data-scroll-target="#central-limit-theorem">Central Limit Theorem</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A Replication of Karlan and List (2007)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Rob Loftus </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<style>
.btn, .form-control, pre, code, pre code {
  border-radius: 4px;
}
.table {
  width: auto;
}
ul, ol {
  padding-left: 18px;
}
code, pre, pre code {
  overflow: auto;
  white-space: pre;
  word-wrap: normal;
}
code {
  color: #c7254e;
  background-color: #f9f2f4;
}
pre {
  background-color: #ffffff;
}
</style>
<hr>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Dean Karlan at Yale and John List at the University of Chicago conducted a field experiment to test the effectiveness of different fundraising letters. They sent out 50,000 fundraising letters to potential donors, randomly assigning each letter to one of three treatments: a standard letter, a matching grant letter, or a challenge grant letter. They published the results of this experiment in the <em>American Economic Review</em> in 2007. The article and supporting data are available from the <a href="https://www.aeaweb.org/articles?id=10.1257/aer.97.5.1774">AEA website</a> and from Innovations for Poverty Action as part of <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/27853&amp;version=4.2">Harvard’s Dataverse</a>.</p>
<p>In this large-scale natural field experiment, the researchers partnered with a well-known nonprofit organization to test whether matching donations would increase both the likelihood of giving and the amount given. The experiment used a randomized controlled design, with some donors receiving a standard solicitation letter, while others received a letter indicating that their donation would be matched by a major donor at either a 1:1, 2:1, or 3:1 ratio. The randomized assignment allowed the authors to estimate causal effects of these treatments on charitable behavior by comparing response rates and donation amounts across the different groups. The primary outcomes measured were whether a donation was made and, conditional on giving, how much was donated.</p>
<p>This project seeks to replicate their results by conducting a structured analysis of the original dataset. We begin by verifying the integrity of the experimental design through checks for proper randomization across treatment groups. Next, we conduct a series of descriptive and inferential statistical analyses to examine how donation behavior varies by treatment group and match ratio. These analyses include t-tests, regression models, and simulation-based visualizations to confirm both the authors original findings.</p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<section id="description" class="level3">
<h3 class="anchored" data-anchor-id="description">Description</h3>
<p>The dataset consists of 50,083 individual observations, each representing a potential donor who received one of the fundraising letters. It includes 52 variables encompassing a range of data types. These variables fall into several categories: treatment assignment (e.g., standard vs.&nbsp;matching letter, and the level of the match ratio: 1:1, 2:1, or 3:1), demographic characteristics (such as gender, household size, and income estimates), past donation behavior (including donation frequency and recency), and outcome measures indicating whether a donation was made and the amount donated. This dataset enables us to analyze how different strategies and characteristics influence charitable giving through randomized A/B testing.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Variable Definitions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>treatment</code></td>
<td>Treatment</td>
</tr>
<tr class="even">
<td><code>control</code></td>
<td>Control</td>
</tr>
<tr class="odd">
<td><code>ratio</code></td>
<td>Match ratio</td>
</tr>
<tr class="even">
<td><code>ratio2</code></td>
<td>2:1 match ratio</td>
</tr>
<tr class="odd">
<td><code>ratio3</code></td>
<td>3:1 match ratio</td>
</tr>
<tr class="even">
<td><code>size</code></td>
<td>Match threshold</td>
</tr>
<tr class="odd">
<td><code>size25</code></td>
<td>$25,000 match threshold</td>
</tr>
<tr class="even">
<td><code>size50</code></td>
<td>$50,000 match threshold</td>
</tr>
<tr class="odd">
<td><code>size100</code></td>
<td>$100,000 match threshold</td>
</tr>
<tr class="even">
<td><code>sizeno</code></td>
<td>Unstated match threshold</td>
</tr>
<tr class="odd">
<td><code>ask</code></td>
<td>Suggested donation amount</td>
</tr>
<tr class="even">
<td><code>askd1</code></td>
<td>Suggested donation was highest previous contribution</td>
</tr>
<tr class="odd">
<td><code>askd2</code></td>
<td>Suggested donation was 1.25 x highest previous contribution</td>
</tr>
<tr class="even">
<td><code>askd3</code></td>
<td>Suggested donation was 1.50 x highest previous contribution</td>
</tr>
<tr class="odd">
<td><code>ask1</code></td>
<td>Highest previous contribution (for suggestion)</td>
</tr>
<tr class="even">
<td><code>ask2</code></td>
<td>1.25 x highest previous contribution (for suggestion)</td>
</tr>
<tr class="odd">
<td><code>ask3</code></td>
<td>1.50 x highest previous contribution (for suggestion)</td>
</tr>
<tr class="even">
<td><code>amount</code></td>
<td>Dollars given</td>
</tr>
<tr class="odd">
<td><code>gave</code></td>
<td>Gave anything</td>
</tr>
<tr class="even">
<td><code>amountchange</code></td>
<td>Change in amount given</td>
</tr>
<tr class="odd">
<td><code>hpa</code></td>
<td>Highest previous contribution</td>
</tr>
<tr class="even">
<td><code>ltmedmra</code></td>
<td>Small prior donor: last gift was less than median $35</td>
</tr>
<tr class="odd">
<td><code>freq</code></td>
<td>Number of prior donations</td>
</tr>
<tr class="even">
<td><code>years</code></td>
<td>Number of years since initial donation</td>
</tr>
<tr class="odd">
<td><code>year5</code></td>
<td>At least 5 years since initial donation</td>
</tr>
<tr class="even">
<td><code>mrm2</code></td>
<td>Number of months since last donation</td>
</tr>
<tr class="odd">
<td><code>dormant</code></td>
<td>Already donated in 2005</td>
</tr>
<tr class="even">
<td><code>female</code></td>
<td>Female</td>
</tr>
<tr class="odd">
<td><code>couple</code></td>
<td>Couple</td>
</tr>
<tr class="even">
<td><code>state50one</code></td>
<td>State tag: 1 for one observation of each of 50 states; 0 otherwise</td>
</tr>
<tr class="odd">
<td><code>nonlit</code></td>
<td>Nonlitigation</td>
</tr>
<tr class="even">
<td><code>cases</code></td>
<td>Court cases from state in 2004-5 in which organization was involved</td>
</tr>
<tr class="odd">
<td><code>statecnt</code></td>
<td>Percent of sample from state</td>
</tr>
<tr class="even">
<td><code>stateresponse</code></td>
<td>Proportion of sample from the state who gave</td>
</tr>
<tr class="odd">
<td><code>stateresponset</code></td>
<td>Proportion of treated sample from the state who gave</td>
</tr>
<tr class="even">
<td><code>stateresponsec</code></td>
<td>Proportion of control sample from the state who gave</td>
</tr>
<tr class="odd">
<td><code>stateresponsetminc</code></td>
<td>stateresponset - stateresponsec</td>
</tr>
<tr class="even">
<td><code>perbush</code></td>
<td>State vote share for Bush</td>
</tr>
<tr class="odd">
<td><code>close25</code></td>
<td>State vote share for Bush between 47.5% and 52.5%</td>
</tr>
<tr class="even">
<td><code>red0</code></td>
<td>Red state</td>
</tr>
<tr class="odd">
<td><code>blue0</code></td>
<td>Blue state</td>
</tr>
<tr class="even">
<td><code>redcty</code></td>
<td>Red county</td>
</tr>
<tr class="odd">
<td><code>bluecty</code></td>
<td>Blue county</td>
</tr>
<tr class="even">
<td><code>pwhite</code></td>
<td>Proportion white within zip code</td>
</tr>
<tr class="odd">
<td><code>pblack</code></td>
<td>Proportion black within zip code</td>
</tr>
<tr class="even">
<td><code>page18_39</code></td>
<td>Proportion age 18-39 within zip code</td>
</tr>
<tr class="odd">
<td><code>ave_hh_sz</code></td>
<td>Average household size within zip code</td>
</tr>
<tr class="even">
<td><code>median_hhincome</code></td>
<td>Median household income within zip code</td>
</tr>
<tr class="odd">
<td><code>powner</code></td>
<td>Proportion house owner within zip code</td>
</tr>
<tr class="even">
<td><code>psch_atlstba</code></td>
<td>Proportion who finished college within zip code</td>
</tr>
<tr class="odd">
<td><code>pop_propurban</code></td>
<td>Proportion of population urban within zip code</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="balance-test" class="level3">
<h3 class="anchored" data-anchor-id="balance-test">Balance Test</h3>
<p>As an ad hoc test of the randomization mechanism, I provide a series of tests that compare aspects of the treatment and control groups to assess whether they are statistically significantly different from one another.</p>
<p>To validate the randomization of the experimental design and ensure there was no systematic bias between the treatment and control groups, I conducted a series of balance tests using both t-tests and bivariate linear regressions. I selected three representative variables that reflect a range of relevant dimensions: dormant, a binary variable indicating whether a person had made a donation in 2005 (capturing past donation tendencies); pblack, the proportion of Black residents in a donor’s ZIP code (representing demographic composition); and median_hhincome, the median household income within the ZIP code (reflecting affluence). These variables were chosen to ensure the sample was balanced across behavioral, demographic, and socioeconomic dimensions. In each case, the tests revealed statistically insignificant p-values when comparing the treatment and control groups, indicating no meaningful differences between groups. These results provide strong support for the integrity of the random assignment process used in the original experiment.</p>
<section id="balance-test---variable-1---dormant" class="level5">
<h5 class="anchored" data-anchor-id="balance-test---variable-1---dormant"><strong>Balance Test - Variable #1 - “dormant”</strong></h5>
</section>
<section id="t-test" class="level5">
<h5 class="anchored" data-anchor-id="t-test"><strong>T-Test</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Pairwise mean comparisons (t-test)
Data      : r_data[["karlan_list_2007_rl"]] 
Variables : treatment_factor, dormant 
Samples   : independent 
Confidence: 0.95 
Adjustment: None 

 treatment_factor  mean      n n_missing    sd    se    me
                0 0.523 16,687         0 0.499 0.004 0.008
                1 0.524 33,396         0 0.499 0.003 0.005

 Null hyp. Alt. hyp.          diff   p.value se    t.value df       2.5%  97.5%  
 0 = 1     0 not equal to 1   -0.001 0.862   0.006 -0.174  33362.05 -0.01 0.008  

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="regression" class="level5">
<h5 class="anchored" data-anchor-id="regression"><strong>Regression</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Linear regression (OLS)
Data     : r_data[["karlan_list_2007_rl"]] 
Response variable    : dormant 
Explanatory variables: treatment_factor 
Null hyp.: the effect of treatment_factor on dormant is zero
Alt. hyp.: the effect of treatment_factor on dormant is not zero

                    coefficient std.error t.value p.value    
 (Intercept)              0.523     0.004 135.247  &lt; .001 ***
 treatment_factor|1       0.001     0.005   0.174   0.862    

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-squared: 0,  Adjusted R-squared: 0 
F-statistic: 0.03 df(1,50081), p.value 0.862
Nr obs: 50,083 </code></pre>
</div>
</div>
</section>
<section id="balance-test---variable-2---pblack" class="level5">
<h5 class="anchored" data-anchor-id="balance-test---variable-2---pblack"><strong>Balance Test - Variable #2 - “pblack”</strong></h5>
</section>
<section id="t-test-1" class="level5">
<h5 class="anchored" data-anchor-id="t-test-1"><strong>T-Test</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Pairwise mean comparisons (t-test)
Data      : r_data[["karlan_list_2007_rl"]] 
Variables : treatment_factor, pblack 
Samples   : independent 
Confidence: 0.95 
Adjustment: None 

 treatment_factor  mean      n n_missing    sd    se    me
                0 0.087 16,687       698 0.137 0.001 0.002
                1 0.087 33,396     1,338 0.135 0.001 0.001

 Null hyp. Alt. hyp.          diff p.value se t.value df       2.5%   97.5%  
 0 = 1     0 not equal to 1   0    0.922   0  -0.098  31555.78 -0.003 0.002  

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="regression-1" class="level5">
<h5 class="anchored" data-anchor-id="regression-1"><strong>Regression</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Linear regression (OLS)
Data     : r_data[["karlan_list_2007_rl"]] 
Response variable    : pblack 
Explanatory variables: treatment_factor 
Null hyp.: the effect of treatment_factor on pblack is zero
Alt. hyp.: the effect of treatment_factor on pblack is not zero

                    coefficient std.error t.value p.value    
 (Intercept)              0.087     0.001  80.617  &lt; .001 ***
 treatment_factor|1       0.000     0.001   0.098   0.922    

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-squared: 0,  Adjusted R-squared: 0 
F-statistic: 0.01 df(1,48045), p.value 0.922
Nr obs: 48,047 </code></pre>
</div>
</div>
</section>
<section id="balance-test---variable-3---median_hhincome" class="level5">
<h5 class="anchored" data-anchor-id="balance-test---variable-3---median_hhincome"><strong>Balance Test - Variable #3 - “median_hhincome”</strong></h5>
</section>
<section id="t-test-2" class="level5">
<h5 class="anchored" data-anchor-id="t-test-2"><strong>T-Test</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Pairwise mean comparisons (t-test)
Data      : r_data[["karlan_list_2007_rl"]] 
Variables : treatment_factor, median_hhincome 
Samples   : independent 
Confidence: 0.95 
Adjustment: None 

 treatment_factor       mean      n n_missing         sd      se      me
                0 54,921.094 16,687       651 21,932.012 173.193 339.477
                1 54,763.169 33,396     1,223 22,074.818 123.070 241.221

 Null hyp. Alt. hyp.          diff    p.value se      t.value df       2.5%     97.5%    
 0 = 1     0 not equal to 1   157.925 0.457   212.466 0.743   32222.13 -258.517 574.368  

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="regression-2" class="level5">
<h5 class="anchored" data-anchor-id="regression-2"><strong>Regression</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Linear regression (OLS)
Data     : r_data[["karlan_list_2007_rl"]] 
Response variable    : median_hhincome 
Explanatory variables: treatment_factor 
Null hyp.: the effect of treatment_factor on median_hhincome is zero
Alt. hyp.: the effect of treatment_factor on median_hhincome is not zero

                    coefficient std.error t.value p.value    
 (Intercept)          54921.094   173.946 315.736  &lt; .001 ***
 treatment_factor|1    -157.925   212.929  -0.742   0.458    

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-squared: 0,  Adjusted R-squared: 0 
F-statistic: 0.55 df(1,48207), p.value 0.458
Nr obs: 48,209 </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="experimental-results" class="level2">
<h2 class="anchored" data-anchor-id="experimental-results">Experimental Results</h2>
<section id="charitable-contribution-made" class="level3">
<h3 class="anchored" data-anchor-id="charitable-contribution-made">Charitable Contribution Made</h3>
<p>First, I analyze whether matched donations lead to an increased response rate of making a donation.</p>
<p>In the bar chart below, you will see the proportion of people who donated for the control group (0) and for the treatment group (1).18% of the people om the control group, i.e.&nbsp;not match offered, donated. While 22% of the people in the treatment group, offered a donation match, donated. Furthermore, this difference in whether they donated based on which group they were in is statically significant (p value = .002) as reflected in both the T-Test and Linear Regression. I also ran a Probit Regression which resulted in a positive co-efficient for the treatment group and a statistically significant p-value, meaning that people in the treatment groupu were more liekly to donate than those in the control group.</p>
<section id="proportion-of-people-who-donated-by-treatment-vs-control-group" class="level5">
<h5 class="anchored" data-anchor-id="proportion-of-people-who-donated-by-treatment-vs-control-group"><strong>Proportion of People Who Donated by Treatment vs Control Group</strong></h5>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_questions_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="donated-by-treatment-vs-control-group---t-test" class="level5">
<h5 class="anchored" data-anchor-id="donated-by-treatment-vs-control-group---t-test"><strong>Donated by Treatment vs Control Group - T-Test</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Pairwise mean comparisons (t-test)
Data      : r_data[["karlan_list_2007_rl"]] 
Variables : treatment_factor, gave 
Samples   : independent 
Confidence: 0.95 
Adjustment: None 

 treatment_factor  mean      n n_missing    sd    se    me
                0 0.018 16,687         0 0.132 0.001 0.002
                1 0.022 33,396         0 0.147 0.001 0.002

 Null hyp. Alt. hyp.          diff   p.value se    t.value df       2.5%   97.5%    
 0 = 1     0 not equal to 1   -0.004 0.001   0.001 -3.209  36576.84 -0.007 -0.002 **

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_questions_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="donated-by-treatment-vs-control-group---linear-regression" class="level5">
<h5 class="anchored" data-anchor-id="donated-by-treatment-vs-control-group---linear-regression"><strong>Donated by Treatment vs Control Group - Linear Regression</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Linear regression (OLS)
Data     : r_data[["karlan_list_2007_rl"]] 
Response variable    : gave 
Explanatory variables: treatment_factor 
Null hyp.: the effect of treatment_factor on gave is zero
Alt. hyp.: the effect of treatment_factor on gave is not zero

                    coefficient std.error t.value p.value    
 (Intercept)              0.018     0.001  16.225  &lt; .001 ***
 treatment_factor|1       0.004     0.001   3.101   0.002 ** 

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-squared: 0,  Adjusted R-squared: 0 
F-statistic: 9.618 df(1,50081), p.value 0.002
Nr obs: 50,083 </code></pre>
</div>
</div>
</section>
<section id="donated-by-treatment-vs-control-group---probit-regression" class="level5">
<h5 class="anchored" data-anchor-id="donated-by-treatment-vs-control-group---probit-regression"><strong>Donated by Treatment vs Control Group - Probit Regression</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = gave ~ treatment, family = binomial(link = "probit"), 
    data = r_data[["karlan_list_2007_rl"]])

Coefficients:
            Estimate Std. Error z value             Pr(&gt;|z|)    
(Intercept) -2.10014    0.02332 -90.074 &lt; 0.0000000000000002 ***
treatment    0.08678    0.02788   3.113              0.00185 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 10071  on 50082  degrees of freedom
Residual deviance: 10061  on 50081  degrees of freedom
AIC: 10065

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</section>
</section>
<section id="differences-between-match-rates" class="level3">
<h3 class="anchored" data-anchor-id="differences-between-match-rates">Differences between Match Rates</h3>
<p>Next, I assesed the effectiveness of different sizes of matched donations on the response rate.</p>
<p>In this exercise, the goal is to see whether there is an significant impact on whether people donate based on the donation match offer they were provided (1:1, 2:1, or 3:1). For that reason, the data that is relevant is only the people that are in the Treatment group, so the Control group is excluded in this series of analysis. To do so, again, I completed a series of T-Tests and Regressions on whether someone made a donation based on the Match Ratio group they were in.</p>
<p>In this analysis we compared each of the different match ratios - 1:1 vs 2:1, 1:1 vs 3:1, and 2:1 vs 3:1. The results showed that there was no statistically significant different in detonation likelihood between any of the groups (1:1 vs 2:1 –&gt; p-value = .335, 1:1 vs 3:1 –&gt; p-value = .31, 2:1 vs 3:1 –&gt; p-value - .96).</p>
<p>While the data was not statistically, increasing the match ratio from 1:1 –&gt; 2:1 or 3:1 has a small, but visible impact on donation rates. However, there is no real noticeable impact when match rates go from 2:1 –&gt; 3:1. This is likely indicating that there is diminishing returns in raising the match ratio past 2:1.</p>
<section id="donated-by-match-ratio---treatment-group-only---t-test" class="level5">
<h5 class="anchored" data-anchor-id="donated-by-match-ratio---treatment-group-only---t-test"><strong>Donated by Match Ratio - Treatment Group Only - T-Test</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Pairwise mean comparisons (t-test)
Data      : r_data[["treatment"]] 
Variables : ratio_factor, gave 
Samples   : independent 
Confidence: 0.95 
Adjustment: None 

 ratio_factor  mean      n n_missing    sd    se    me
            1 0.021 11,133         0 0.143 0.001 0.003
            2 0.023 11,134         0 0.149 0.001 0.003
            3 0.023 11,129         0 0.149 0.001 0.003

 Null hyp. Alt. hyp.          diff   p.value se    t.value df       2.5%   97.5%  
 1 = 2     1 not equal to 2   -0.002 0.335   0.002 -0.965  22225.08 -0.006 0.002  
 1 = 3     1 not equal to 3   -0.002 0.31    0.002 -1.015  22215.05 -0.006 0.002  
 2 = 3     2 not equal to 3    0.000 0.96    0.000 -0.050  22260.85 -0.004 0.004  

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="donated-by-match-ratio---treatment-group-only---regression" class="level5">
<h5 class="anchored" data-anchor-id="donated-by-match-ratio---treatment-group-only---regression"><strong>Donated by Match Ratio - Treatment Group Only - Regression</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Linear regression (OLS)
Data     : r_data[["treatment"]] 
Response variable    : gave 
Explanatory variables: ratio_factor 
Null hyp.: the effect of ratio_factor on gave is zero
Alt. hyp.: the effect of ratio_factor on gave is not zero

                coefficient std.error t.value p.value    
 (Intercept)          0.021     0.001  14.912  &lt; .001 ***
 ratio_factor|2       0.002     0.002   0.958   0.338    
 ratio_factor|3       0.002     0.002   1.008   0.313    

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-squared: 0,  Adjusted R-squared: 0 
F-statistic: 0.645 df(2,33393), p.value 0.524
Nr obs: 33,396 </code></pre>
</div>
</div>
</section>
<section id="donated-by-match-ratio-response-rate---treatment-group-only" class="level5">
<h5 class="anchored" data-anchor-id="donated-by-match-ratio-response-rate---treatment-group-only"><strong>Donated by Match Ratio Response Rate - Treatment Group Only</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = gave ~ ratio_factor, family = binomial(link = "probit"), 
    data = r_data[["treatment"]])

Coefficients:
              Estimate Std. Error z value            Pr(&gt;|z|)    
(Intercept)   -2.03852    0.02705 -75.373 &lt;0.0000000000000002 ***
ratio_factor2  0.03635    0.03767   0.965               0.335    
ratio_factor3  0.03821    0.03764   1.015               0.310    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 7071.3  on 33395  degrees of freedom
Residual deviance: 7070.0  on 33393  degrees of freedom
AIC: 7076

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
</section>
</section>
<section id="size-of-charitable-contribution" class="level3">
<h3 class="anchored" data-anchor-id="size-of-charitable-contribution">Size of Charitable Contribution</h3>
<p>In this subsection, I analyze the effect of the size of matched donation on the size of the charitable contribution.</p>
<p>For this exercise, I completed this analysis in two different ways 1) analyzing the impact on the size of the donation for all people in the dataset 2) analyzing the impact on the size of donation for just the people who actually made a donation.</p>
<p>When looking at the size of donation for the treatment group vs the control group, the results did not show a statically significant difference between in the size of donation between groups (p-value = .055). The results were right on the cusp of reaching statistical significance with a 95% confidence.The average donation size for the treatment group was 0.97 and the control group was 0.81.</p>
<p>When running this same analysis for the just the donors, the results were far from statistically significant in showing that there was a difference in donation size between the groups (p-value = .559). The average donation size amount favored the control group, 45.54 vs the treatment group, 43.87. It should be noted that the standard error was greater for the control vs the treatment group.</p>
<p>The second measurement is a more effective way to answer this question: “does a match rate impact the size of a charitable contribution.” The reason for this is that we’ve already determined that people are more likely to make a donation based on be presented with a donation match opportunity. So what we are really interested in here is: do the people who donate that are in the treatment group donate a different amount than the people who donated from the control group. This analysis suggests that there is no difference in the amount donated between the groups.</p>
<section id="size-of-donation-by-treatment-vs-control-group---t-test" class="level5">
<h5 class="anchored" data-anchor-id="size-of-donation-by-treatment-vs-control-group---t-test"><strong>Size of Donation by Treatment vs Control Group - T-Test</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Pairwise mean comparisons (t-test)
Data      : r_data[["karlan_list_2007_rl"]] 
Variables : treatment_factor, amount 
Samples   : independent 
Confidence: 0.95 
Adjustment: None 

 treatment_factor  mean      n n_missing    sd    se    me
                0 0.813 16,687         0 8.176 0.063 0.124
                1 0.967 33,396         0 8.963 0.049 0.096

 Null hyp. Alt. hyp.          diff   p.value se   t.value df       2.5%   97.5%  
 0 = 1     0 not equal to 1   -0.154 0.055   0.08 -1.918  36216.06 -0.311 0.003 .

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_questions_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="size-of-donation-by-treatment-vs-control-group---only-donors---t-test" class="level5">
<h5 class="anchored" data-anchor-id="size-of-donation-by-treatment-vs-control-group---only-donors---t-test"><strong>Size of Donation by Treatment vs Control Group - Only Donors - T-Test</strong></h5>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Pairwise mean comparisons (t-test)
Data      : r_data[["gave"]] 
Variables : treatment_factor, amount 
Samples   : independent 
Confidence: 0.95 
Adjustment: None 

 treatment_factor   mean   n n_missing     sd    se    me
                0 45.540 298         0 41.380 2.397 4.717
                1 43.872 736         0 42.016 1.549 3.040

 Null hyp. Alt. hyp.          diff  p.value se    t.value df     2.5%   97.5%  
 0 = 1     0 not equal to 1   1.668 0.559   2.853 0.585   557.46 -3.937 7.274  

Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_questions_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="size-of-donation-by-treatment-vs-control-group---only-donors---histogram" class="level5">
<h5 class="anchored" data-anchor-id="size-of-donation-by-treatment-vs-control-group---only-donors---histogram"><strong>Size of Donation by Treatment vs Control Group - Only Donors - Histogram</strong></h5>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_questions_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="simulation-experiment" class="level2">
<h2 class="anchored" data-anchor-id="simulation-experiment">Simulation Experiment</h2>
<p>As a reminder of how the t-statistic “works,” in this section I use simulation to demonstrate the Law of Large Numbers and the Central Limit Theorem.</p>
<p>Suppose the true distribution of respondents who do not get a charitable donation match is Bernoulli with probability p=0.018 that a donation is made.</p>
<p>Further suppose that the true distribution of respondents who do get a charitable donation match of any size is Bernoulli with probability p=0.022 that a donation is made.</p>
<section id="law-of-large-numbers" class="level3">
<h3 class="anchored" data-anchor-id="law-of-large-numbers">Law of Large Numbers</h3>
<p>This plot shows how the cumulative average of random differences between treatment and control donations stabilizes as the number of draws increases. Each point reflects the average difference after that many samples.</p>
<p>The blue line is the empirical average of differences over simulations, and the red dashed line shows the true difference in means between treatment and control groups.</p>
<p>As we draw more samples, the cumulative average converges toward the true mean difference, demonstrating the law of large numbers and validating the robustness of the estimated treatment effect.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_questions_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="central-limit-theorem" class="level3">
<h3 class="anchored" data-anchor-id="central-limit-theorem">Central Limit Theorem</h3>
<p>Here are the four histograms showing the distribution of average differences (treatment – control) for sample sizes of 50, 200, 500, and 1000. Each histogram shows how the distribution of sample mean differences evolves as sample size increases.The red line at 0 shows the null hypothesis (i.e.&nbsp;no effect). The true difference in means is 0.004, so we expect the bulk of the distribution to be <strong>centered near 0.004.</strong></p>
<p>As the sample size increases and reaches 1000, it’s clear that the distribution is centered around 0.004, and <strong>zero lies in the tail</strong>. This suggest that the treatment effect is real and detectable with large enough samples.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1_questions_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>